; Supervisor program definition for the JSVV serial listener.
; Adjust directory, user and /etc/rozhlas/rozhlas.env to match the deployment.

[program:rozhlas_jsvv_listener]
directory=/opt/rozhlas
command=/usr/bin/env bash -lc 'source /etc/rozhlas/rozhlas.env && cd /opt/rozhlas && PYTHON_BIN=${PYTHON_BIN:-python3}; args=(daemons/jsvv_listener.py --port "${JSVV_PORT:?JSVV_PORT is required}"); [[ -n "${JSVV_BAUDRATE:-}" ]] && args+=(--baudrate "${JSVV_BAUDRATE}"); [[ -n "${JSVV_PARITY:-}" ]] && args+=(--parity "${JSVV_PARITY}"); [[ -n "${JSVV_STOPBITS:-}" ]] && args+=(--stopbits "${JSVV_STOPBITS}"); [[ -n "${JSVV_BYTESIZE:-}" ]] && args+=(--bytesize "${JSVV_BYTESIZE}"); [[ -n "${JSVV_TIMEOUT_MS:-}" ]] && args+=(--timeout-ms "${JSVV_TIMEOUT_MS}"); exec "$PYTHON_BIN" "${args[@]}"'
autostart=true
autorestart=true
startsecs=3
stopwaitsecs=10
user=rozhlas
redirect_stderr=true
stdout_logfile=/var/log/rozhlas/jsvv_listener.log
environment=APP_ENV="production",PYTHONPATH="/opt/rozhlas/python-client/src"
