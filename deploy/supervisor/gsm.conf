; Supervisor program definition for the GSM modem listener (SIM7600).
; Ensure the environment file exports GSM_* variables required by the daemon.

[program:rozhlas_gsm_listener]
directory=/opt/rozhlas
command=/usr/bin/env bash -lc 'source /etc/rozhlas/rozhlas.env && cd /opt/rozhlas && PYTHON_BIN=${PYTHON_BIN:-python3}; args=(daemons/gsm_listener.py --port "${GSM_SERIAL_PORT:?GSM_SERIAL_PORT is required}" --baudrate "${GSM_SERIAL_BAUDRATE:-115200}" --bytesize "${GSM_SERIAL_BYTESIZE:-8}" --parity "${GSM_SERIAL_PARITY:-N}" --stopbits "${GSM_SERIAL_STOPBITS:-1}" --timeout-serial "${GSM_SERIAL_TIMEOUT:-0.5}" --write-timeout "${GSM_SERIAL_WRITE_TIMEOUT:-1}" --poll "${GSM_POLL_INTERVAL:-0.2}" --graceful "${GSM_GRACEFUL_TIMEOUT:-5}" --signal-interval "${GSM_SIGNAL_INTERVAL:-30}" --answer-delay "${GSM_AUTO_ANSWER_DELAY_MS:-1000}" --max-ring "${GSM_MAX_RING_ATTEMPTS:-6}" --project-root /opt/rozhlas --artisan-bin "${ARTISAN_BIN:-php}" --artisan-path "${ARTISAN_PATH:-artisan}" --artisan-command "${GSM_ARTISAN_COMMAND:-gsm:test-send}"); [[ -n "${GSM_WEBHOOK:-}" ]] && args+=(--webhook "${GSM_WEBHOOK}"); [[ -n "${GSM_TOKEN:-}" ]] && args+=(--token "${GSM_TOKEN}"); [[ -n "${GSM_WEBHOOK_TIMEOUT:-}" ]] && args+=(--timeout "${GSM_WEBHOOK_TIMEOUT}"); [[ "${GSM_SIMULATE:-}" == "1" || "${GSM_SIMULATE:-}" == "true" ]] && args+=(--simulate); exec "$PYTHON_BIN" "${args[@]}"'
autostart=true
autorestart=true
startsecs=3
stopwaitsecs=10
user=rozhlas
redirect_stderr=true
stdout_logfile=/var/log/rozhlas/gsm_listener.log
environment=APP_ENV="production",PYTHONPATH="/opt/rozhlas/python-client/src"
